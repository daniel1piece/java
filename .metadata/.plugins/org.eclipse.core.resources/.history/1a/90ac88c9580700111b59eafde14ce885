package platzi.play.utils;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import platzi.play.contenido.Genero;
import platzi.play.contenido.Pelicula;

public class FileUtils {
	
	public static final String NOMBRE_ARCHIVO = "contenido.txt";
	public static final String SEPARADOR = "|";
	
	public static void escribirContenido(Pelicula contenido) {
//		String linea = contenido.getTitulo() + SEPARADOR + contenido.getDuracion() + SEPARADOR + contenido.getGenero() + SEPARADOR + contenido.getCalificacion() + SEPARADOR + contenido.getFechaEstreno(); 
		String linea = String.join(SEPARADOR, contenido.getTitulo(), contenido.getDuracion(), contenido.getGenero(), contenido.getCalificacion(), contenido.getFechaEstreno());
	}
	
	public static List<Pelicula> leerContenido() {
		List<Pelicula> contenidoDesdeArchivo = new ArrayList<>();
		
		try {
			List<String> lineas = Files.readAllLines(Paths.get(NOMBRE_ARCHIVO));
			
			lineas.forEach(linea -> {
				String[] datos = linea.split("\\" + SEPARADOR);
				
				if (datos.length == 5) {
					String titulo = datos[0];
					int duracion = Integer.parseInt(datos[1]);
					Genero genero = Genero.valueOf(datos[2]);
					double calificacion = !datos[3].isBlank()? Double.parseDouble(datos[3]):0;
					LocalDate fechaEstreno = datos[4].isBlank() ? LocalDate.of(2000, 1, 1) : LocalDate.parse(datos[4]);
					
					Pelicula pelicula = new Pelicula(titulo, duracion, genero, calificacion);
					pelicula.setFechaEstreno(fechaEstreno);
					
					contenidoDesdeArchivo.add(pelicula);
				}
			});
		} catch (IOException e) {
			System.out.println("Ocurrio un error leyendo el archivo: " + e.getMessage());
		}
		
		return contenidoDesdeArchivo;
	}
}
