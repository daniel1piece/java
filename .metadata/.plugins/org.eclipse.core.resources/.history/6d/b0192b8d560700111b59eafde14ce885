package platzi.play;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.time.LocalDate;
import java.util.List;

import platzi.play.contenido.Genero;
import platzi.play.contenido.Pelicula;
import platzi.play.contenido.ResumenContenido;
import platzi.play.excepcion.PeliculaExistenteExcepcion;
import platzi.play.plataforma.Plataforma;
import platzi.play.plataforma.Usuario;
import platzi.play.utils.ScannerUtils;

public class Main {
	public static final String NOMBRE_PLATAFORMA = "PLATZI PLAY ðŸ¿";
	public static final String VERSION = "1.0.0";	
	public static final int AGREGAR = 1;
	public static final int MOSTRAR_TODO = 2;
	public static final int BUSCAR_POR_TITULO = 3;
	public static final int BUSCAR_POR_GENERO = 4;
	public static final int VER_POPULARES = 5;
	public static final int REPRODUCIR = 6;
	public static final int ELIMINAR = 8;
	public static final int SALIR = 9;
	
	public static void main(String[] args) {
		Plataforma plataforma = new Plataforma(NOMBRE_PLATAFORMA);
		System.out.println(NOMBRE_PLATAFORMA + " v" + VERSION);
		
		cargarPeliculas(plataforma);
		
		System.out.println("Mas de " + plataforma.getDuracionTotal() + " minutos de contenido!\n");
		
		while (true) {
			int opcionElegida = ScannerUtils.capturarNumero("""
					
					Ingrese una de las siguintes opciones:
					1. Agregar Contenido
					2. Mostrar Todo
					3. Buscar Por Titulo
					4. Buscar Por Genero
					5. Ver Populares
					6. Reproducir
					8. Eliminar
					9. Salir
					
					""");
	
			switch (opcionElegida) {
			   case AGREGAR -> {
					String nombre = ScannerUtils.capturarTexto("Nombre del contenido?: ");
					Genero genero = ScannerUtils.capturarGeneros("Genero del contenido?:");
					int duracion = ScannerUtils.capturarNumero("Duracion del contenido?: ");
					double calificacion = ScannerUtils.capturarDecimal("Calificacion del contenido?: ");				
					
					try {
						plataforma.agregar(new Pelicula(nombre, duracion, genero, calificacion));
					} catch (PeliculaExistenteExcepcion e) {
						System.out.println(e.getMessage());
					}
		
					
				}				
				case MOSTRAR_TODO -> {
					List<ResumenContenido> contenidosResumidos = plataforma.getResumenes();
					contenidosResumidos.forEach(resumen -> System.out.println(resumen.toString()));
				}
				case BUSCAR_POR_TITULO -> {
					String nombreBuscado = ScannerUtils.capturarTexto("Cual es el nombre del contenido a buscar?");
					Pelicula pelicula = plataforma.buscarPorTitulo(nombreBuscado);
					
					if (pelicula != null) {
						System.out.println(pelicula.obtenerFichaTecnica());
					} else {
						System.out.println(nombreBuscado + " no existe dentro de " + plataforma.getNombre());
					}
				}	
				case BUSCAR_POR_GENERO -> {
					Genero generoBuscado = ScannerUtils.capturarGeneros("Genero del contenido a buscar?: ");
					
					List<Pelicula> contenidoPorGenero = plataforma.buscarPorGenero(generoBuscado);
					
					System.out.println(contenidoPorGenero.size() + " encontrado para el genero " + generoBuscado);
					contenidoPorGenero.forEach(elemento -> System.out.println("âœ¨ " + elemento.obtenerFichaTecnica() + "\n"));
				}
				case VER_POPULARES -> {
					int cantidad = ScannerUtils.capturarNumero("Cantidad de peliculas a mostrar?");
					
					List<Pelicula> contenidoPopulares = plataforma.getPopulares(cantidad);
					contenidoPopulares.forEach( pelicula ->
							System.out.println(pelicula.obtenerFichaTecnica() + "\n")
					);
				}				
				case REPRODUCIR -> {
					String nombre = ScannerUtils.capturarTexto("Nombre del contenido a reproducir?");
					Pelicula contenido = plataforma.buscarPorTitulo(nombre);
					
					if (contenido != null) {
						plataforma.reproducir(contenido);
					} else {
						System.out.println(nombre + " no existen dentro de " + plataforma.getNombre());
					}
				}				
				case ELIMINAR -> {
					String nombreAEliminar = ScannerUtils.capturarTexto("Cual es el nombre del contenido a eliminar?");
					Pelicula contenido = plataforma.buscarPorTitulo(nombreAEliminar);
					
					if (contenido != null) {
						plataforma.eliminar(contenido);
						System.out.println(nombreAEliminar + " eliminado! âŒ");
					} else {
						System.out.println(nombreAEliminar + " no existe dentro de " + plataforma.getNombre());
					}
				}				
				case SALIR -> {
					System.exit(0);
				}				
				default -> {
					throw new IllegalArgumentException("Unexpected value: " + opcionElegida);
				}				
			}
		}
	
	}
	
	public static void cargarPeliculas(Plataforma plataforma) {
		
		try {
			List<String> lineas = Files.readAllLines(Paths.get("contenido.txt"));
			
			lineas.forEach(linea -> {
				String[] datos = linea.split("\\|");
				
				if (datos.length == 5) {
					String titulo = datos[0];
					int duracion = Integer.parseInt(datos[1]);
					Genero genero = Genero.valueOf(datos[2]);
					double calificacion = !datos[3].isBlank()? Double.parseDouble(datos[3]):0;
					LocalDate fechaEstreno = datos[4].isBlank() ? LocalDate.of(2000, 1, 1) : LocalDate.parse(datos[4]);
					
					Pelicula pelicula = new Pelicula(titulo, duracion, genero, calificacion);
					pelicula.setFechaEstreno(fechaEstreno);
					
					plataforma.agregar(pelicula);
				}
			});
		} catch (IOException e) {
			System.out.println("Ocurrio un error leyendo el archivo: " + e.getMessage());
		}
	}
}



































